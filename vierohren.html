<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Welser Logistik - Kommunikationstraining</title>
    <!-- Tailwind CSS f√ºr schnelles, responsives Design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Noto Sans f√ºr gute Lesbarkeit -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons f√ºr moderne Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
            background-color: #f3f4f6;
            overscroll-behavior-y: none;
        }
        .app-container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        .chat-bubble {
            position: relative;
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 20px;
            margin-bottom: 10px;
            font-size: 0.95rem;
            animation: popIn 0.3s ease-out both;
        }
        .chat-left {
            background-color: #e5e7eb;
            color: #1f2937;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }
        .chat-right {
            background-color: #3b82f6;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .ear-card {
            transition: all 0.2s;
            cursor: pointer;
        }
        .ear-card:active {
            transform: scale(0.98);
        }
        .ear-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        main {
            flex: 1;
            padding-bottom: 80px;
        }
        /* Styles f√ºr das Quiz in Kap 3 */
        .quiz-btn {
            transition: all 0.2s;
        }
        .quiz-btn.correct {
            background-color: #dcfce7 !important; /* green-100 */
            border-color: #22c55e !important; /* green-500 */
            color: #15803d !important;
        }
        .quiz-btn.wrong {
            background-color: #fee2e2 !important; /* red-100 */
            border-color: #ef4444 !important; /* red-500 */
            color: #b91c1c !important;
            opacity: 0.6;
        }
    </style>
</head>
<body>

<div class="app-container relative">

    <!-- Header & Navigation -->
    <header class="bg-slate-800 text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-md">
        <div class="flex items-center gap-2">
            <i data-lucide="package" class="h-6 w-6 text-orange-500"></i>
            <h1 class="font-bold text-lg">Welser Logistik Campus</h1>
        </div>
        <button onclick="toggleMenu()" class="p-2 focus:outline-none">
            <i data-lucide="menu" class="h-6 w-6"></i>
        </button>
    </header>

    <!-- Mobile Menu Overlay -->
    <div id="menuOverlay" class="fixed inset-0 bg-black bg-opacity-90 z-[60] hidden flex flex-col justify-center items-center text-white space-y-6 text-xl transform transition-transform">
        <button onclick="toggleMenu()" class="absolute top-4 right-4"><i data-lucide="x" class="h-8 w-8"></i></button>
        <a href="#" onclick="navigate(1); toggleMenu()" class="hover:text-orange-500">1. Start & Intro</a>
        <a href="#" onclick="navigate(2); toggleMenu()" class="hover:text-orange-500">2. Das Modell (Theorie)</a>
        <a href="#" onclick="navigate(3); toggleMenu()" class="hover:text-orange-500">3. √úbung: H√∂r-Training</a>
        <a href="#" onclick="navigate(4); toggleMenu()" class="hover:text-orange-500">4. Blitz-Runde</a>
        <a href="#" onclick="navigate(5); toggleMenu()" class="hover:text-orange-500">5. E-Mail Check</a>
        <a href="#" onclick="navigate(6); toggleMenu()" class="hover:text-orange-500">6. Challenge</a>
    </div>

    <!-- Main Content Area -->
    <main id="contentArea" class="p-4 overflow-y-auto">
        <!-- Content will be injected via JS -->
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 p-3 fixed bottom-0 w-full max-w-[600px] flex items-center justify-between text-xs text-gray-500 z-40">
        <div>
            <span class="block font-bold">Johannes Heinrich 2025</span>
            <span>Welser Logistik Training</span>
        </div>
        <img src="https://www.welserschule.de/wp-content/uploads/2025/11/BS4_Logo_Web_ohneSlogan.jpg" 
             alt="Logo" 
             class="h-10 object-contain"
             onerror="this.style.display='none'; this.parentElement.innerHTML+=' (Logo)'">
    </footer>

</div>

<script>
    // --- State Management ---
    let currentChapter = 1;
    let retoureQuizIndex = 0; // State f√ºr Kap 3 Quiz

    // --- Content Data ---
    const chapters = {
        1: {
            title: "Das Missverst√§ndnis",
            render: () => `
                <div class="fade-in space-y-6">
                    <div class="bg-orange-100 border-l-4 border-orange-500 p-4 text-orange-700">
                        <p class="font-bold">Situation:</p>
                        <p>Ein normaler Tag im Lager. Sie schauen auf Ihr Handy und sehen diesen Chatverlauf zwischen dem Lagerleiter und einem Azubi.</p>
                    </div>
                    
                    <div class="flex flex-col space-y-2 p-4 bg-white rounded-lg shadow-inner h-64 overflow-y-auto" id="chatSim">
                        <!-- Chat JS injects here -->
                    </div>

                    <div class="text-center space-y-4">
                        <button id="playChatBtn" onclick="startChat()" class="bg-slate-200 text-slate-700 px-4 py-2 rounded-full text-sm font-semibold mb-2 flex items-center justify-center mx-auto gap-2">
                            <i data-lucide="play-circle" class="w-4 h-4"></i> Chat abspielen
                        </button>
                        
                        <!-- Reflection Section (Initially Visible) -->
                        <div id="reflectionArea" class="hidden text-left bg-white p-4 rounded shadow-lg border border-gray-100">
                            <label class="block font-bold text-slate-800 mb-2">Deine Meinung:</label>
                            <p class="text-sm text-gray-600 mb-3">Warum reagiert der Azubi so zickig? Der Chef hat doch nur eine Frage gestellt.</p>
                            <textarea id="userReflection" class="w-full p-2 border border-gray-300 rounded mb-3 text-sm" rows="2" placeholder="Tippe hier deine Idee ein..."></textarea>
                            <button onclick="revealAnalysis()" class="w-full bg-orange-500 text-white font-bold py-2 rounded shadow hover:bg-orange-600 transition">
                                Aufl√∂sung zeigen
                            </button>
                        </div>

                        <!-- Analysis (Initially Hidden) -->
                        <div id="analysisArea" class="hidden p-4 bg-blue-50 rounded shadow text-left border-l-4 border-blue-500 fade-in">
                            <h3 class="font-bold text-slate-800 mb-2">Die Analyse:</h3>
                            <p class="text-sm text-gray-700">Genau! Das Problem ist nicht, was der Chef <em>gesagt</em> hat (Sachebene), sondern was der Azubi <em>geh√∂rt</em> hat.</p>
                            <p class="text-sm text-gray-700 mt-2 font-semibold">Der Chef sendete: "Ist die Palette fertig?"</p>
                            <p class="text-sm text-gray-700 font-semibold text-red-600">Der Azubi h√∂rte: "Du bist zu langsam! Mach hinne!"</p>
                            
                            <!-- Internal Next Button (Contextual) -->
                            <button onclick="navigate(2)" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg flex justify-center items-center gap-2 transition transform active:scale-95">
                                Weiter zu Kapitel 2 <i data-lucide="arrow-right" class="w-5 h-5"></i>
                            </button>
                        </div>

                    </div>
                </div>
            `,
            init: () => {
                document.getElementById('reflectionArea').classList.add('hidden');
            }
        },
        2: {
            title: "Das 4-Seiten Modell",
            render: () => `
                <div class="fade-in space-y-5">
                    <p class="text-gray-600 text-sm">Der Kommunikations-Profi <strong>Friedemann Schulz von Thun</strong> sagt: Jede Nachricht ist ein Paket mit 4 Seiten. Wir senden (Schnabel) und h√∂ren (Ohr) immer auf 4 Kan√§len gleichzeitig.</p>
                    <p class="text-xs text-slate-400 text-center font-bold uppercase tracking-wider mb-2">Tippe auf eine Karte f√ºr mehr Infos</p>

                    <!-- Theorie Teil: Klickbar -->
                    <div class="grid grid-cols-1 gap-3">
                        
                        <!-- 1. Sache -->
                        <div onclick="toggleInfo('sach-info')" class="ear-card bg-blue-50 border-l-4 border-blue-500 p-3 rounded shadow-sm">
                            <div class="flex justify-between items-center">
                                <h3 class="font-bold text-blue-800 flex items-center gap-2"><i data-lucide="info" class="w-4 h-4"></i> 1. Der Sachinhalt</h3>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-blue-400"></i>
                            </div>
                            <div id="sach-info" class="hidden mt-2 text-sm text-gray-700 border-t border-blue-100 pt-2">
                                üëâ <strong>Wor√ºber informiere ich?</strong><br>
                                Hier geht es um reine Daten, Fakten und Sachverhalte. Ist die Aussage wahr oder falsch? Relevant oder unwichtig?
                                <br><em class="text-xs text-blue-600">Beispiel: "Die Lieferung ist unvollst√§ndig."</em>
                            </div>
                        </div>

                        <!-- 2. Selbstoffenbarung -->
                        <div onclick="toggleInfo('self-info')" class="ear-card bg-green-50 border-l-4 border-green-500 p-3 rounded shadow-sm">
                            <div class="flex justify-between items-center">
                                <h3 class="font-bold text-green-800 flex items-center gap-2"><i data-lucide="user" class="w-4 h-4"></i> 2. Selbstoffenbarung</h3>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-green-400"></i>
                            </div>
                            <div id="self-info" class="hidden mt-2 text-sm text-gray-700 border-t border-green-100 pt-2">
                                üëâ <strong>Was gebe ich von mir preis?</strong><br>
                                Infos √ºber den Sender: Wie geht es ihm? Ist er gestresst? Professionell?
                                <br><em class="text-xs text-green-600">Beispiel: Wer schreit, offenbart: "Ich habe meine Emotionen nicht im Griff."</em>
                            </div>
                        </div>

                        <!-- 3. Beziehung -->
                        <div onclick="toggleInfo('bez-info')" class="ear-card bg-yellow-50 border-l-4 border-yellow-500 p-3 rounded shadow-sm">
                            <div class="flex justify-between items-center">
                                <h3 class="font-bold text-yellow-800 flex items-center gap-2"><i data-lucide="users" class="w-4 h-4"></i> 3. Beziehungsebene</h3>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-yellow-400"></i>
                            </div>
                            <div id="bez-info" class="hidden mt-2 text-sm text-gray-700 border-t border-yellow-100 pt-2">
                                üëâ <strong>Wie stehe ich zu dir?</strong><br>
                                Zeigt sich oft im Tonfall, Anrede oder Mimik. "Du-Botschaften" sind hier oft kritisch.
                                <br><em class="text-xs text-yellow-600">Beispiel: Keine Begr√º√üung signalisiert "Du bist mir egal".</em>
                            </div>
                        </div>

                        <!-- 4. Appell -->
                        <div onclick="toggleInfo('appell-info')" class="ear-card bg-red-50 border-l-4 border-red-500 p-3 rounded shadow-sm">
                            <div class="flex justify-between items-center">
                                <h3 class="font-bold text-red-800 flex items-center gap-2"><i data-lucide="megaphone" class="w-4 h-4"></i> 4. Appell</h3>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-red-400"></i>
                            </div>
                            <div id="appell-info" class="hidden mt-2 text-sm text-gray-700 border-t border-red-100 pt-2">
                                üëâ <strong>Wozu will ich dich veranlassen?</strong><br>
                                Der Sender will Einfluss nehmen. Der Empf√§nger soll etwas tun, denken oder f√ºhlen.
                                <br><em class="text-xs text-red-600">Beispiel: "Wir brauchen die Ware bis 12 Uhr!" (Mach hinne!)</em>
                            </div>
                        </div>

                    </div>
                </div>
            `,
            init: () => {}
        },
        3: {
            title: "√úbung 1: H√∂r-Training",
            render: () => `
                <div class="fade-in space-y-5">
                     <div class="bg-slate-800 text-white p-4 rounded-lg shadow mb-4 flex gap-3 items-center">
                        <i data-lucide="ear" class="w-8 h-8 text-orange-400"></i>
                        <div>
                            <h3 class="font-bold">Welches Ohr ist aktiv?</h3>
                            <p class="text-xs text-slate-300">Lies die Situation und was die Person h√∂rt.</p>
                        </div>
                    </div>

                    <div class="p-4 bg-white rounded-lg shadow-md border border-gray-200">
                        <!-- Dynamic Quiz Content -->
                        <div id="quizContainer">
                            <!-- Situation Context -->
                            <p class="text-xs uppercase text-gray-400 font-bold mb-1">Situation (Gesagt):</p>
                            <div id="qSituation" class="bg-gray-100 p-3 rounded-lg border-l-4 border-slate-500 mb-4 font-bold text-slate-800 min-h-[50px] flex items-center">
                                <!-- JS inserts situation here -->
                            </div>

                            <p class="text-xs uppercase text-gray-400 font-bold mb-1">Empf√§nger (Geh√∂rt):</p>
                            <div id="qHeard" class="mb-4 font-medium text-blue-800 italic min-h-[40px]">
                                <!-- JS inserts heard text here -->
                            </div>
                            
                            <!-- Buttons -->
                            <p class="text-xs text-center text-gray-400 mb-2 mt-6">Tippe auf das aktive Ohr:</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="checkRetoure('sach')" class="quiz-btn border border-blue-200 bg-blue-50 text-blue-800 p-3 rounded text-sm font-bold hover:bg-blue-100 flex flex-col items-center"><i data-lucide="info" class="w-4 h-4 mb-1"></i> Sachinhalt</button>
                                <button onclick="checkRetoure('selbst')" class="quiz-btn border border-green-200 bg-green-50 text-green-800 p-3 rounded text-sm font-bold hover:bg-green-100 flex flex-col items-center"><i data-lucide="user" class="w-4 h-4 mb-1"></i> Selbst</button>
                                <button onclick="checkRetoure('bez')" class="quiz-btn border border-yellow-200 bg-yellow-50 text-yellow-800 p-3 rounded text-sm font-bold hover:bg-yellow-100 flex flex-col items-center"><i data-lucide="users" class="w-4 h-4 mb-1"></i> Beziehung</button>
                                <button onclick="checkRetoure('appell')" class="quiz-btn border border-red-200 bg-red-50 text-red-800 p-3 rounded text-sm font-bold hover:bg-red-100 flex flex-col items-center"><i data-lucide="megaphone" class="w-4 h-4 mb-1"></i> Appell</button>
                            </div>
                            <div id="retoureFeedback" class="hidden mt-4 p-3 rounded text-sm font-bold text-center"></div>
                        </div>
                        
                        <!-- Success State (hidden initially) -->
                        <div id="quizSuccess" class="hidden text-center py-6">
                            <i data-lucide="check-circle" class="w-16 h-16 text-green-500 mx-auto mb-4"></i>
                            <h3 class="text-xl font-bold text-slate-800 mb-2">H√∂r-Test bestanden!</h3>
                            <p class="text-gray-600 mb-6">Du hast alle Situationen richtig eingesch√§tzt.</p>
                        </div>

                    </div>
                </div>
            `,
            init: () => {
                retoureQuizIndex = 0;
                renderRetoureQuiz();
            }
        },
        4: {
            title: "√úbung 2: Blitz-Runde",
            render: () => `
                <div class="fade-in space-y-6">
                    <p class="text-sm text-gray-600">Oft verwechseln wir Fakten mit Aufforderungen. Entscheide schnell: Ist das prim√§r eine Sachinfo oder ein versteckter Appell?</p>

                    <div class="bg-white p-4 rounded-lg shadow-md border-t-4 border-purple-500">
                        <h3 class="font-bold text-purple-900 mb-4 flex items-center gap-2"><i data-lucide="zap" class="w-5 h-5"></i> Speed-Check</h3>
                        
                        <div id="speedRoundContainer" class="space-y-6">
                            <!-- Q1 -->
                            <div class="border-b border-gray-100 pb-4">
                                <div class="bg-gray-50 p-2 rounded mb-2 font-mono text-sm">"Der M√ºlleimer ist voll."</div>
                                <div class="flex gap-2">
                                    <button onclick="solveSpeed(this, 'sach')" class="flex-1 bg-white border border-gray-300 py-3 rounded text-sm font-bold shadow-sm hover:bg-blue-50 text-blue-700">Sachinhalt</button>
                                    <button onclick="solveSpeed(this, 'appell')" class="flex-1 bg-white border border-gray-300 py-3 rounded text-sm font-bold shadow-sm hover:bg-red-50 text-red-700">Appell</button>
                                </div>
                                <div class="hidden mt-2 p-2 bg-slate-100 text-xs text-gray-600 rounded">
                                    <strong>Aufl√∂sung:</strong> Beides! Sachlich: "Er ist voll." Aber meistens gemeint: "Bring ihn weg!" (Appell).
                                </div>
                            </div>

                            <!-- Q2 -->
                            <div class="pb-2">
                                <div class="bg-gray-50 p-2 rounded mb-2 font-mono text-sm">"Wir haben keine Kartons mehr Gr√∂√üe M."</div>
                                <div class="flex gap-2">
                                    <button onclick="solveSpeed(this, 'sach')" class="flex-1 bg-white border border-gray-300 py-3 rounded text-sm font-bold shadow-sm hover:bg-blue-50 text-blue-700">Sachinhalt</button>
                                    <button onclick="solveSpeed(this, 'appell')" class="flex-1 bg-white border border-gray-300 py-3 rounded text-sm font-bold shadow-sm hover:bg-red-50 text-red-700">Appell</button>
                                </div>
                                <div class="hidden mt-2 p-2 bg-slate-100 text-xs text-gray-600 rounded">
                                    <strong>Aufl√∂sung:</strong> Auch hier versteckt sich oft der Appell: "Bestell sofort neue!"
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            init: () => {}
        },
        5: {
            title: "√úbung 3: E-Mail Analyse",
            render: () => `
                <div class="fade-in space-y-6">
                    <p class="text-sm text-gray-600">Jetzt wird es ernst. Analysiere diese echte "Horror-Mail" aus dem Alltag.</p>

                    <div class="bg-white p-4 rounded-lg shadow-md border-t-4 border-red-500">
                        <h3 class="font-bold text-red-900 mb-2 flex items-center gap-2"><i data-lucide="mail-warning" class="w-5 h-5"></i> E-Mail Check</h3>
                        <div class="bg-gray-50 p-3 rounded border border-gray-200 text-xs font-mono mb-4 text-gray-700 leading-relaxed">
                            <strong>Von:</strong> Lager (M√ºller)<br>
                            <strong>Betreff:</strong> SCHON WIEDER KAPUTT!!!<br><br>
                            Sagen Sie mal, sind Ihre Fahrer eigentlich blind? <br>
                            Die Lieferung heute morgen ist eine Katastrophe. Alles aufgerissen. Wenn Sie keine Lust haben zu arbeiten, suchen wir wen anders.<br>
                            M√ºller
                        </div>

                        <div id="mailQuizContainer" class="space-y-4">
                            <!-- Frage 1 -->
                            <div class="bg-slate-50 p-3 rounded border border-slate-100">
                                <p class="text-sm font-bold mb-2 text-slate-800">1. "Sind Ihre Fahrer blind?"</p>
                                <p class="text-xs text-gray-500 mb-2">Welches Ohr h√∂rt hier zu?</p>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="solveMail(this, false)" class="bg-white border p-2 rounded text-xs font-medium shadow-sm">Sachinhalt</button>
                                    <button onclick="solveMail(this, true)" class="bg-white border p-2 rounded text-xs font-medium shadow-sm">Beziehung</button>
                                </div>
                                <div class="feedback hidden mt-2 text-xs"></div>
                            </div>

                            <!-- Frage 2 -->
                            <div class="bg-slate-50 p-3 rounded border border-slate-100">
                                <p class="text-sm font-bold mb-2 text-slate-800">2. Was ist die Selbstoffenbarung?</p>
                                <div class="grid grid-cols-1 gap-2">
                                    <button onclick="solveMail(this, true)" class="bg-white border p-2 rounded text-xs font-medium text-left px-3 shadow-sm">"Ich bin w√ºtend und habe keine Geduld mehr."</button>
                                    <button onclick="solveMail(this, false)" class="bg-white border p-2 rounded text-xs font-medium text-left px-3 shadow-sm">"Die Ware ist besch√§digt."</button>
                                </div>
                                <div class="feedback hidden mt-2 text-xs"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            init: () => {}
        },
        6: {
            title: "Deine Challenge",
            render: () => `
                 <div class="fade-in space-y-6 text-center">
                    <div class="bg-slate-800 text-white p-6 rounded-xl shadow-xl">
                        <i data-lucide="users" class="w-12 h-12 mx-auto mb-4 text-orange-400"></i>
                        <h2 class="text-2xl font-bold mb-2">Partnerarbeit</h2>
                        <p class="text-slate-300 text-sm">Such dir einen Partner im Klassenzimmer oder chatte mit deinem Sitznachbarn.</p>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow-md border border-gray-200 text-left">
                        <h3 class="font-bold text-orange-600 uppercase text-xs mb-2">Mission:</h3>
                        <p class="font-bold mb-2">Verwandle die "Wut-Mail" in eine Profi-Mail!</p>
                        <p class="text-sm text-gray-700 mb-4">Herr M√ºller hat die Beziehungsebene vergiftet. Formuliert gemeinsam m√ºndlich oder per WhatsApp einen Satz, der:</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
                            <li>Den Sachinhalt klar nennt (Ware kaputt).</li>
                            <li>Auf der Beziehungsebene h√∂flich bleibt.</li>
                            <li>Einen klaren Appell enth√§lt.</li>
                        </ul>
                    </div>

                    <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                        <h4 class="font-bold text-green-800 mb-1">Musterl√∂sung anzeigen?</h4>
                        <p class="text-xs text-green-700 mb-3">Erst selbst probieren!</p>
                        <button onclick="document.getElementById('solution').classList.remove('hidden')" class="bg-green-600 text-white px-3 py-1 rounded text-sm shadow hover:bg-green-700">L√∂sung zeigen</button>
                        
                        <div id="solution" class="hidden mt-4 text-left bg-white p-3 rounded text-sm text-gray-800 border-l-4 border-green-500 animate-pulse">
                            "Sehr geehrte Damen und Herren, leider kam die Lieferung besch√§digt an. Bitte senden Sie uns bis zum [Datum] Ersatz."
                        </div>
                    </div>
                </div>
            `,
            init: () => {}
        }
    };

    // --- Interaction Functions ---
    
    function toggleInfo(id) {
        const el = document.getElementById(id);
        const parent = el.parentElement;
        
        // Close others? Optional, but cleaner on mobile
        // document.querySelectorAll('[id$="-info"]').forEach(d => { if(d.id !== id) d.classList.add('hidden') });

        el.classList.toggle('hidden');
        
        // Rotate Icon logic optional, keeping it simple
        if (!el.classList.contains('hidden')) {
            el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    }


    // --- Logic for Chapter 3 (H√∂r-Training) ---
    const quizQuestions = [
        // --- Szenario 1: Die Retoure (4 Fragen) ---
        {
            situation: "Lagerleiter: \"Da vorne steht ja immer noch die Retoure von gestern!\"",
            text: "Der Azubi h√∂rt: \"Der Chef hat heute extrem schlechte Laune.\"",
            correct: "selbst",
            feedback: "Richtig! Er interpretiert die Stimmung des Chefs (Selbstoffenbarung)."
        },
        {
            situation: "Lagerleiter: \"Da vorne steht ja immer noch die Retoure von gestern!\"",
            text: "Der Azubi h√∂rt: \"Fakt ist: Das Paket steht noch am Tor 1.\"",
            correct: "sach",
            feedback: "Korrekt. Das ist die reine sachliche Feststellung."
        },
        {
            situation: "Lagerleiter: \"Da vorne steht ja immer noch die Retoure von gestern!\"",
            text: "Der Azubi h√∂rt: \"Du bist unzuverl√§ssig! Warum hast du das nicht gemacht?\"",
            correct: "bez",
            feedback: "Genau. Er f√ºhlt sich pers√∂nlich angegriffen (Beziehungsohr)."
        },
        {
            situation: "Lagerleiter: \"Da vorne steht ja immer noch die Retoure von gestern!\"",
            text: "Der Azubi h√∂rt: \"R√§um das sofort weg!\"",
            correct: "appell",
            feedback: "Stimmt! Er h√∂rt eine Aufforderung."
        },
        // --- Szenario 2: Der Stapler ---
        {
            situation: "Kollege im Pausenraum: \"Der Gabelstapler h√§ngt nicht am Ladeger√§t.\"",
            text: "Du h√∂rst: \"Immer vergisst du das Anschlie√üen! Du bist echt schlampig.\"",
            correct: "bez",
            feedback: "Richtig. Der Kollege nennt nur einen Fakt, aber du f√ºhlst dich kritisiert (Beziehung)."
        },
        // --- Szenario 3: Der Kunde ---
        {
            situation: "Kunde am Telefon: \"Ich warte schon seit einer Woche auf meine Lieferung!\"",
            text: "Du h√∂rst: \"Der Kunde ist w√ºtend und entt√§uscht.\"",
            correct: "selbst",
            feedback: "Genau. Du h√∂rst heraus, was im Anderen vorgeht (Selbstoffenbarung)."
        },
        // --- Szenario 4: Zeitdruck ---
        {
            situation: "Schichtleiter: \"In einer Stunde geht der LKW. Wir haben noch 10 Paletten.\"",
            text: "Du h√∂rst: \"Arbeite schneller! Gib Gas!\"",
            correct: "appell",
            feedback: "Korrekt. Du h√∂rst den Befehl zur Handlung (Appell)."
        }
    ];

    function renderRetoureQuiz() {
        const container = document.getElementById('quizContainer');
        const successDiv = document.getElementById('quizSuccess');
        const sitEl = document.getElementById('qSituation');
        const heardEl = document.getElementById('qHeard');
        const feedbackEl = document.getElementById('retoureFeedback');
        const btns = document.querySelectorAll('#quizContainer .quiz-btn');

        if (retoureQuizIndex >= quizQuestions.length) {
            container.classList.add('hidden');
            successDiv.classList.remove('hidden');
            lucide.createIcons();
            return;
        }

        const q = quizQuestions[retoureQuizIndex];
        
        // Reset Feedback
        feedbackEl.classList.add('hidden');
        feedbackEl.className = "hidden mt-4 p-3 rounded text-sm font-bold text-center";
        
        // Reset Buttons
        btns.forEach(btn => {
            btn.classList.remove('opacity-50', 'pointer-events-none', 'ring-2', 'ring-green-500', 'ring-red-500', 'bg-green-100', 'bg-red-100');
            // Restore original classes roughly (simplification)
            // Actually simpler just to not remove the base classes in the first place
        });

        // Set Text
        sitEl.innerHTML = `"${q.situation}"`;
        heardEl.innerHTML = `"${q.text}"`;
        
        lucide.createIcons();
    }

    function checkRetoure(answer) {
        const q = quizQuestions[retoureQuizIndex];
        const feedbackEl = document.getElementById('retoureFeedback');
        
        if (answer === q.correct) {
            feedbackEl.innerText = q.feedback;
            feedbackEl.className = "mt-4 p-3 rounded text-sm font-bold text-center bg-green-100 text-green-700 fade-in";
            feedbackEl.classList.remove('hidden');
            setTimeout(() => {
                retoureQuizIndex++;
                renderRetoureQuiz();
            }, 2000);
        } else {
            feedbackEl.innerText = "Nicht ganz richtig. Versuch ein anderes Ohr!";
            feedbackEl.className = "mt-4 p-3 rounded text-sm font-bold text-center bg-red-100 text-red-700 fade-in";
            feedbackEl.classList.remove('hidden');
        }
    }


    // --- Core Functions ---

    function toggleMenu() {
        const menu = document.getElementById('menuOverlay');
        menu.classList.toggle('hidden');
    }

    function startChat() {
        const chatContainer = document.getElementById('chatSim');
        const playBtn = document.getElementById('playChatBtn');
        const reflectionArea = document.getElementById('reflectionArea');
        
        if(!chatContainer) return;
        
        chatContainer.innerHTML = ''; // Reset
        playBtn.classList.add('hidden'); // Hide button
        
        const messages = [
            { text: "Chef: Ist die Palette fertig?", side: "left", delay: 500 },
            { text: "Azubi: Ich mach ja schon so schnell ich kann!!", side: "right", delay: 2000 },
            { text: "Chef: ??? Ich wollte nur wissen, ob sie fertig ist f√ºr den LKW.", side: "left", delay: 4000 },
            { text: "Azubi: Achso... Ups. Ja, steht bereit.", side: "right", delay: 6500 }
        ];

        let cumDelay = 0;
        messages.forEach(msg => {
            cumDelay += msg.delay;
            setTimeout(() => {
                const bubble = document.createElement('div');
                bubble.className = `chat-bubble ${msg.side === 'left' ? 'chat-left' : 'chat-right'}`;
                bubble.innerText = msg.text;
                chatContainer.appendChild(bubble);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, cumDelay);
        });

        // Show Reflection area after chat ends
        setTimeout(() => {
            reflectionArea.classList.remove('hidden');
            reflectionArea.classList.add('fade-in');
        }, cumDelay + 1000);
    }

    function revealAnalysis() {
        const userInput = document.getElementById('userReflection').value;
        const analysisArea = document.getElementById('analysisArea');
        const reflectionBtn = document.querySelector('#reflectionArea button');
        
        if (userInput.trim() === "") {
            alert("Schreib kurz deine Meinung rein, bevor du aufl√∂st! üòâ");
            return;
        }

        reflectionBtn.classList.add('hidden'); // Hide button
        document.getElementById('userReflection').disabled = true; // Disable input
        analysisArea.classList.remove('hidden');
        
        // Scroll to analysis
        setTimeout(() => {
             analysisArea.scrollIntoView({behavior: "smooth"});
        }, 100);
    }

    function solveSpeed(btn, type) {
        const explanation = btn.parentElement.nextElementSibling;
        explanation.classList.remove('hidden');
        explanation.classList.add('fade-in');
        
        // Visual feedback
        btn.classList.add('ring-2', 'ring-offset-1', 'ring-slate-400', 'bg-slate-50');
    }

    function solveMail(btn, isCorrect) {
        const feedbackDiv = btn.parentElement.nextElementSibling;
        const allBtns = btn.parentElement.querySelectorAll('button');
        
        allBtns.forEach(b => {
            b.classList.remove('bg-green-100', 'bg-red-100', 'border-green-500', 'border-red-500');
            b.classList.add('bg-white');
        });

        if (isCorrect) {
            btn.classList.remove('bg-white');
            btn.classList.add('bg-green-100', 'border-green-500');
            feedbackDiv.innerHTML = "<span class='text-green-600 font-bold'>Richtig!</span>";
            feedbackDiv.classList.remove('hidden');
        } else {
            btn.classList.remove('bg-white');
            btn.classList.add('bg-red-100', 'border-red-500');
            feedbackDiv.innerHTML = "<span class='text-red-600 font-bold'>Falsch.</span>";
            feedbackDiv.classList.remove('hidden');
        }
    }

    function navigate(chapterId) {
        currentChapter = chapterId;
        renderChapter(chapterId);
        window.scrollTo(0,0);
    }

    function renderChapter(id) {
        const contentArea = document.getElementById('contentArea');
        const chapter = chapters[id];
        const totalChapters = Object.keys(chapters).length;
        
        if (!chapter) return;

        // --- Navigation Logic ---
        let navHtml = '<div class="mt-8 pt-6 border-t border-gray-200 flex justify-between items-center gap-4">';
        
        // Back Button
        if (id > 1) {
            navHtml += `
                <button onclick="navigate(${id - 1})" class="flex items-center gap-2 text-slate-600 hover:text-slate-900 font-bold px-4 py-2 rounded hover:bg-slate-100 transition">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i> Zur√ºck
                </button>
            `;
        } else {
            navHtml += '<div></div>'; // Spacer to keep Next button on the right
        }

        // Next Button
        if (id < totalChapters) {
             navHtml += `
                <button onclick="navigate(${id + 1})" class="flex items-center gap-2 text-blue-600 hover:text-blue-800 font-bold px-4 py-2 rounded hover:bg-blue-50 transition">
                    Weiter <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </button>
            `;
        } else if (id === totalChapters) {
             navHtml += `
                <button onclick="navigate(1)" class="flex items-center gap-2 text-orange-600 hover:text-orange-800 font-bold px-4 py-2 rounded hover:bg-orange-50 transition">
                    <i data-lucide="rotate-ccw" class="w-4 h-4"></i> Neustart
                </button>
            `;
        } else {
             navHtml += '<div></div>';
        }
        
        navHtml += '</div>';

        // Render Title + Content + Nav
        const html = `
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-800 mb-1">Kapitel ${id}</h2>
                <h3 class="text-lg text-orange-600 font-semibold border-b border-orange-200 pb-2">${chapter.title}</h3>
            </div>
            ${chapter.render()}
            ${navHtml}
        `;

        contentArea.innerHTML = html;
        lucide.createIcons(); // Refresh icons
        
        if (chapter.init) {
            chapter.init();
        }
    }

    // --- Init App ---
    document.addEventListener('DOMContentLoaded', () => {
        renderChapter(1);
        lucide.createIcons();
    });

</script>
</body>
</html>
