<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Founder's Dungeon: Legal Legends</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #111;
            color: #e2e8f0;
            image-rendering: pixelated;
        }
        .font-mono { font-family: 'Roboto Mono', monospace; }
        
        /* Retro UI Box Styles */
        .retro-box {
            border: 4px solid #4a5568;
            box-shadow: 6px 6px 0px #000;
            background-color: #2d3748;
        }
        .retro-panel {
            background-color: #1a202c;
            border: 2px solid #4a5568;
            padding: 10px;
        }

        .btn-retro {
            background-color: #4a5568;
            border: 2px solid #cbd5e0;
            box-shadow: 3px 3px 0px #000;
            transition: all 0.1s;
            cursor: pointer;
            position: relative;
            top: 0;
            text-transform: uppercase;
            font-size: 0.7rem;
        }
        .btn-retro:active { top: 3px; box-shadow: 0px 0px 0px #000; }
        .btn-retro:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(100%); }

        /* Specific Button Styles */
        .btn-safe { background-color: #276749; border-color: #48bb78; }
        .btn-normal { background-color: #2c5282; border-color: #63b3ed; }
        .btn-risk { background-color: #9c4221; border-color: #f6ad55; }
        .btn-salary { background-color: #b7791f; border-color: #f6e05e; color: #000; }

        /* Slot Machine */
        .slot-window {
            background-color: #000;
            border: 4px inset #718096;
            overflow: hidden;
            position: relative;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .slot-reel { font-size: 40px; line-height: 100px; text-align: center; filter: blur(0px); transition: filter 0.1s; }
        .slot-blur { filter: blur(5px); }

        /* Animations */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            25% { transform: translate(-2px, -2px) rotate(-1deg); }
            50% { transform: translate(2px, 2px) rotate(1deg); }
            75% { transform: translate(-1px, -1px) rotate(0deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        .shake-anim { animation: shake 0.4s; animation-iteration-count: 2; }
        
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .pop-anim { animation: pop 0.3s ease-out; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a202c; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 4px; }
    </style>
</head>
<body class="h-screen w-full flex flex-col items-center justify-center overflow-hidden p-2 bg-gray-900">

    <!-- MAIN CONTAINER -->
    <div id="game-container" class="retro-box w-full max-w-3xl h-[95vh] flex flex-col relative p-4 transition-all duration-200">
        
        <!-- HEADER -->
        <header class="flex justify-between items-end border-b-4 border-gray-600 pb-3 mb-3">
            <div>
                <h1 class="text-yellow-400 text-xs md:text-lg leading-tight mb-1">FOUNDER'S DUNGEON</h1>
                <p class="text-[10px] text-gray-400">Legal Legends Edition</p>
            </div>
            <div class="text-right">
                <span id="header-type" class="block text-blue-300 font-bold text-[10px] md:text-xs">W√§hle Rechtsform</span>
                <span id="header-day" class="block text-[9px] text-gray-500">Monat 0</span>
            </div>
        </header>

        <!-- CONTENT AREA -->
        <main id="screen-area" class="flex-grow flex flex-col relative overflow-hidden">
            <!-- Content injected via JS -->
        </main>

    </div>

    <!-- TEMPLATES -->
    
    <!-- 1. START SCREEN -->
    <template id="tpl-start">
        <div class="flex flex-col items-center justify-center h-full text-center space-y-6 animate-fade-in">
            <div class="text-6xl mb-4 animate-pulse">üèõÔ∏è</div>
            <h2 class="text-sm md:text-base text-white mb-2">Wirtschaft & Recht Simulator</h2>
            <p class="leading-loose text-[10px] md:text-xs text-gray-400 max-w-md mx-auto">
                W√§hle deine Rechtsform weise.<br>
                Sie bestimmt deine Haftung, dein Kapital<br>
                und deine Feinde.<br><br>
                <span class="text-yellow-500">√úberlebe 24 Monate ohne Insolvenz.</span>
            </p>
            <button onclick="game.goToSelection()" class="btn-retro px-8 py-4 text-green-400 font-bold text-xs mt-4 hover:bg-gray-700">
                NEUES SPIEL STARTEN
            </button>
        </div>
    </template>

    <!-- 2. SELECTION SCREEN -->
    <template id="tpl-selection">
        <div class="flex flex-col h-full">
            <h3 class="text-center text-xs text-gray-400 mb-2">W√ÑHLE DEINE RECHTSFORM</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 overflow-y-auto pr-2 flex-grow pb-10">
                
                <!-- EU -->
                <div onclick="game.selectClass('EU')" class="retro-panel hover:bg-gray-700 cursor-pointer group transition relative">
                    <div class="flex justify-between items-start">
                        <div class="text-3xl mr-3">üë§</div>
                        <div class="flex-grow">
                            <h4 class="text-yellow-400 text-xs font-bold">Einzelunternehmen</h4>
                            <p class="text-[9px] text-gray-300 mt-1">Der Klassiker.</p>
                        </div>
                    </div>
                    <ul class="text-[8px] text-gray-400 mt-2 list-disc pl-3 space-y-1">
                        <li>Startkosten: <span class="text-green-400">0 ‚Ç¨</span></li>
                        <li>Haftung: <span class="text-red-500 font-bold">Privat (Voll)</span></li>
                        <li>Vorteil: Maximale Kontrolle</li>
                    </ul>
                </div>

                <!-- OHG -->
                <div onclick="game.selectClass('OHG')" class="retro-panel hover:bg-gray-700 cursor-pointer group transition">
                    <div class="flex justify-between items-start">
                        <div class="text-3xl mr-3">ü§ù</div>
                        <div class="flex-grow">
                            <h4 class="text-orange-400 text-xs font-bold">OHG</h4>
                            <p class="text-[9px] text-gray-300 mt-1">Offene Handelsgesellschaft</p>
                        </div>
                    </div>
                    <ul class="text-[8px] text-gray-400 mt-2 list-disc pl-3 space-y-1">
                        <li>Startkosten: <span class="text-green-400">0 ‚Ç¨</span> (+Partnerkapital)</li>
                        <li>Haftung: <span class="text-red-500 font-bold">Privat (Solidarisch!)</span></li>
                        <li>Risiko: Partnerstreitigkeiten</li>
                    </ul>
                </div>

                <!-- KG -->
                <div onclick="game.selectClass('KG')" class="retro-panel hover:bg-gray-700 cursor-pointer group transition">
                    <div class="flex justify-between items-start">
                        <div class="text-3xl mr-3">ü¶Å</div>
                        <div class="flex-grow">
                            <h4 class="text-orange-300 text-xs font-bold">KG</h4>
                            <p class="text-[9px] text-gray-300 mt-1">Kommanditgesellschaft</p>
                        </div>
                    </div>
                    <ul class="text-[8px] text-gray-400 mt-2 list-disc pl-3 space-y-1">
                        <li>Rolle: <span class="text-yellow-500">Komplement√§r</span> (Chef)</li>
                        <li>Vorteil: Geld vom Kommanditisten</li>
                        <li>Haftung: <span class="text-red-500">Privat (Nur du!)</span></li>
                    </ul>
                </div>

                <!-- GmbH -->
                <div onclick="game.selectClass('GmbH')" class="retro-panel hover:bg-gray-700 cursor-pointer group transition">
                    <div class="flex justify-between items-start">
                        <div class="text-3xl mr-3">üõ°Ô∏è</div>
                        <div class="flex-grow">
                            <h4 class="text-blue-400 text-xs font-bold">GmbH</h4>
                            <p class="text-[9px] text-gray-300 mt-1">Ges. mit beschr. Haftung</p>
                        </div>
                    </div>
                    <ul class="text-[8px] text-gray-400 mt-2 list-disc pl-3 space-y-1">
                        <li>Startkosten: <span class="text-red-400">25.000 ‚Ç¨</span></li>
                        <li>Haftung: <span class="text-green-400 font-bold">Beschr√§nkt</span></li>
                        <li>Nachteil: Hohe B√ºrokratie</li>
                    </ul>
                </div>

                <!-- AG -->
                <div onclick="game.selectClass('AG')" class="retro-panel hover:bg-gray-700 cursor-pointer group transition md:col-span-2">
                    <div class="flex justify-between items-start">
                        <div class="text-3xl mr-3">üèôÔ∏è</div>
                        <div class="flex-grow">
                            <h4 class="text-purple-400 text-xs font-bold">AG (Aktiengesellschaft)</h4>
                            <p class="text-[9px] text-gray-300 mt-1">Die K√∂nigsklasse.</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                         <ul class="text-[8px] text-gray-400 mt-2 list-disc pl-3 space-y-1">
                            <li>Startkosten: <span class="text-red-400">50.000 ‚Ç¨</span></li>
                            <li>Haftung: <span class="text-green-400 font-bold">Beschr√§nkt</span></li>
                        </ul>
                        <ul class="text-[8px] text-gray-400 mt-2 list-disc pl-3 space-y-1">
                            <li>Vorteil: Riesiges Kapital m√∂glich</li>
                            <li>Risiko: Aktion√§re (Hauptversammlung)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- 3. GAME HUD -->
    <template id="tpl-game">
        <div class="flex flex-col h-full justify-between">
            
            <!-- STATS -->
            <div class="grid grid-cols-2 gap-2 mb-2">
                <!-- Private -->
                <div class="retro-panel border-l-4 border-l-red-500 flex flex-col">
                    <span class="text-[8px] text-gray-400 uppercase">Privatverm√∂gen</span>
                    <div class="flex justify-between items-end">
                        <span class="text-xs md:text-sm text-white font-mono" id="hud-private-money">0 ‚Ç¨</span>
                        <span class="text-[8px] text-green-500" id="hud-private-safe">SAFE</span>
                    </div>
                </div>
                <!-- Company -->
                <div class="retro-panel border-l-4 border-l-blue-500 flex flex-col relative">
                    <span class="text-[8px] text-gray-400 uppercase">Firmenkonto</span>
                    <div class="flex justify-between items-end">
                        <span class="text-xs md:text-sm text-white font-mono" id="hud-corp-money">0 ‚Ç¨</span>
                    </div>
                     <span class="absolute top-1 right-1 text-[8px] text-blue-300 border border-blue-300 px-1 rounded" id="hud-form-badge">GmbH</span>
                </div>
            </div>

            <!-- SLOT MACHINE -->
            <div class="retro-box bg-black p-4 flex flex-col items-center justify-center flex-grow relative border-gray-700">
                <!-- Lamps -->
                <div class="flex gap-2 mb-2 absolute top-2 right-2">
                    <div class="w-2 h-2 rounded-full bg-red-900 border border-black" id="lamp-1"></div>
                    <div class="w-2 h-2 rounded-full bg-yellow-900 border border-black" id="lamp-2"></div>
                    <div class="w-2 h-2 rounded-full bg-green-900 border border-black" id="lamp-3"></div>
                </div>

                <!-- Reel -->
                <div class="slot-window w-full bg-gray-800 mb-2 border-2 border-gray-600 rounded">
                    <div id="slot-reel-content" class="slot-reel w-full text-white">üé≤</div>
                </div>

                <!-- Result Display -->
                <div id="result-display" class="h-20 w-full text-center flex flex-col items-center justify-center overflow-hidden p-1">
                    <span class="text-[10px] text-gray-500 animate-pulse">Erwarte Anweisungen...</span>
                </div>
            </div>

            <!-- ACTIONS -->
            <div class="mt-2">
                <!-- Strategy Selection -->
                <div id="controls-area" class="grid grid-cols-3 gap-2">
                    <button onclick="game.spinWheel('safe')" class="btn-retro btn-safe h-14 flex flex-col items-center justify-center group">
                        <span class="text-lg group-hover:scale-110 transition">üõ°Ô∏è</span>
                        <span class="text-[8px] font-bold mt-1">Sicherheit</span>
                    </button>
                    <button onclick="game.spinWheel('normal')" class="btn-retro btn-normal h-14 flex flex-col items-center justify-center group">
                        <span class="text-lg group-hover:scale-110 transition">‚öñÔ∏è</span>
                        <span class="text-[8px] font-bold mt-1">Markt</span>
                    </button>
                    <button onclick="game.spinWheel('risk')" class="btn-retro btn-risk h-14 flex flex-col items-center justify-center group">
                        <span class="text-lg group-hover:scale-110 transition">üöÄ</span>
                        <span class="text-[8px] font-bold mt-1">Risiko</span>
                    </button>
                </div>
                
                <!-- Next Month / Salary -->
                <button onclick="game.withdraw()" id="btn-salary" class="hidden w-full mt-2 btn-retro btn-salary h-14 flex flex-col items-center justify-center">
                    <span class="text-sm font-bold">üíµ GEHALT BUCHEN</span>
                    <span class="text-[8px] opacity-75">Monat abschlie√üen</span>
                </button>
            </div>
        </div>
    </template>

    <!-- 4. GAME OVER -->
    <template id="tpl-gameover">
        <div class="flex flex-col items-center justify-center h-full text-center p-4">
            <h1 id="go-title" class="text-red-500 text-xl md:text-2xl font-bold mb-4 border-b-2 border-red-500 pb-2">INSOLVENZ</h1>
            
            <div class="retro-box p-4 bg-gray-800 w-full text-left mb-4">
                <p id="go-reason" class="text-xs text-gray-300 leading-relaxed mb-4">...</p>
                
                <div class="bg-black p-2 rounded border border-gray-600">
                    <div class="flex justify-between text-xs mb-1">
                        <span class="text-gray-500">Rechtsform:</span>
                        <span id="go-form" class="text-blue-300"></span>
                    </div>
                    <div class="flex justify-between text-xs mb-1">
                        <span class="text-gray-500">√úberlebt:</span>
                        <span id="go-months" class="text-white"></span>
                    </div>
                    <div class="h-px bg-gray-600 my-2"></div>
                    <div class="flex justify-between text-sm font-bold">
                        <span class="text-gray-400">Privat Rest:</span>
                        <span id="go-private" class="text-yellow-400"></span>
                    </div>
                </div>
            </div>

            <div id="go-lesson" class="text-[9px] text-gray-400 italic mb-6 max-w-sm">
                <!-- Specific lesson based on legal form -->
            </div>
            
            <button onclick="location.reload()" class="btn-retro px-6 py-3 text-white text-xs w-full">
                NEU GR√úNDEN
            </button>
        </div>
    </template>

    <script>
        // --- GAME CONFIGURATION ---
        const LEGAL_FORMS = {
            'EU': { 
                name: 'Einzelunternehmen', 
                cost: 0, 
                liability: 'FULL', // Privatverm√∂gen haftet
                bonus: 0,
                desc: 'Du haftest allein mit allem was du hast.'
            },
            'OHG': { 
                name: 'OHG', 
                cost: 0, 
                liability: 'FULL', 
                bonus: 10000, // Partnerkapital
                desc: 'Solidarische Haftung. Einer baut Mist, alle zahlen.'
            },
            'KG': { 
                name: 'KG', 
                cost: 0, 
                liability: 'FULL', // Als Komplement√§r
                bonus: 20000, // Kommanditisteneinlage
                desc: 'Du bist Komplement√§r und haftest voll. Der Kommanditist chillt.'
            },
            'GmbH': { 
                name: 'GmbH', 
                cost: 25000, // Stammkapital
                liability: 'LIMITED', 
                bonus: 25000, // Das Geld liegt ja in der Firma
                desc: 'Haftungsschirm aktiv. Privatverm√∂gen sicher.'
            },
            'AG': { 
                name: 'AG', 
                cost: 50000, // Grundkapital
                liability: 'LIMITED', 
                bonus: 50000, 
                desc: 'Aktion√§re wollen Dividenden sehen.'
            }
        };

        const SCENARIOS = [
            // -- ALLGEMEIN --
            { id: 'S1', type: 'PROFIT', val: 4000, icon: 'üî®', title: 'Solide Arbeit', text: 'Das Tagesgesch√§ft brummt.', risk: 1 },
            { id: 'S2', type: 'LOSS', val: -2000, icon: 'üìâ', title: 'Marktflaute', text: 'Kunden halten das Geld zusammen.', risk: 1 },
            { id: 'S3', type: 'LOSS', val: -3500, icon: 'üí∏', title: 'Inflation', text: 'Materialpreise steigen an.', risk: 1 },
            { id: 'S4', type: 'PROFIT', val: 8000, icon: 'üöÄ', title: 'Viraler Hit', text: 'Deine Marke trendet auf Social Media.', risk: 3 },
            
            // -- RECHTSFORM SPEZIFISCH (Logic handled in JS) --
            // OHG/KG Stress
            { id: 'S_PARTNER', type: 'LOSS', val: -5000, icon: 'ü§¨', title: 'Partnerstreit', text: 'Deine Mitgesellschafter blockieren Entscheidungen.', tags: ['OHG', 'KG'], risk: 2 },
            // AG Stress
            { id: 'S_AG_MEETING', type: 'LOSS', val: -8000, icon: 'üì¢', title: 'Hauptversammlung', text: 'Aktion√§re fordern teure Kurskorrektur & Buffet.', tags: ['AG'], risk: 2 },
            { id: 'S_AG_IPO', type: 'PROFIT', val: 25000, icon: 'üìà', title: 'Aktienkurs Explodiert', text: 'Investoren lieben deine Strategie!', tags: ['AG'], risk: 3 },
            // GmbH B√ºrokratie
            { id: 'S_GMBH_ADMIN', type: 'LOSS', val: -3000, icon: '¬ß', title: 'Jahresabschluss', text: 'Der Steuerberater schreibt eine saftige Rechnung.', tags: ['GmbH', 'AG'], risk: 1 },
            // Haftungskiller (The Lesson)
            { id: 'S_LAWSUIT', type: 'LOSS', val: -40000, icon: '‚öñÔ∏è', title: 'Schadensersatzklage', text: 'Ein Produktfehler verursacht massive Sch√§den!', risk: 3 }
        ];

        class FounderGame {
            constructor() {
                this.privateMoney = 60000; // Start Private Savings
                this.corpMoney = 0;
                this.month = 0;
                this.currentForm = null;
                this.spinning = false;
                this.salary = 3000;
                
                this.ui = {
                    screen: document.getElementById('screen-area'),
                    pMoney: document.getElementById('hud-private-money'),
                    cMoney: document.getElementById('hud-corp-money'),
                    headerForm: document.getElementById('header-type'),
                    headerDay: document.getElementById('header-day')
                };
            }

            init() {
                this.renderTemplate('tpl-start');
            }

            goToSelection() {
                this.renderTemplate('tpl-selection');
            }

            selectClass(key) {
                const form = LEGAL_FORMS[key];
                this.currentForm = { key, ...form };
                
                // Gr√ºndungssimulation
                // Kosten werden vom Privatverm√∂gen abgezogen
                // Bonus (Stammkapital/Einlagen) landet auf dem Firmenkonto
                
                if (this.privateMoney < form.cost) {
                    alert("Nicht genug Privatverm√∂gen f√ºr diese Rechtsform! Du brauchst " + form.cost + "‚Ç¨.");
                    return;
                }

                this.privateMoney -= form.cost;
                this.corpMoney = form.bonus; // Einlage ins Unternehmen
                
                this.month = 1;
                this.startGame();
            }

            startGame() {
                this.renderTemplate('tpl-game');
                this.updateHUD();
                
                // Badge Color logic
                const badge = document.getElementById('hud-form-badge');
                badge.innerText = this.currentForm.name;
                
                const safetyText = document.getElementById('hud-private-safe');
                if (this.currentForm.liability === 'FULL') {
                    safetyText.innerText = "HAFTET";
                    safetyText.className = "text-[8px] text-red-500 blink font-bold";
                }
            }

            spinWheel(strategy) {
                if (this.spinning) return;
                this.spinning = true;
                
                // UI State
                document.getElementById('controls-area').classList.add('opacity-50', 'pointer-events-none');
                const reel = document.getElementById('slot-reel-content');
                const lamps = [document.getElementById('lamp-1'), document.getElementById('lamp-2'), document.getElementById('lamp-3')];
                
                // Cost of doing business (Marketing for Risk strategy)
                if (strategy === 'risk') {
                    this.corpMoney -= 2000;
                    this.updateHUD();
                }

                // Animation
                reel.classList.add('slot-blur');
                let lampInt = setInterval(() => {
                    lamps.forEach(l => l.style.backgroundColor = '#330000');
                    lamps[Math.floor(Math.random()*3)].style.backgroundColor = '#ff0000';
                }, 100);
                
                let icons = ['‚öñÔ∏è', 'üìâ', 'üìà', 'üî®', 'üí∏'];
                let spinInt = setInterval(() => {
                    reel.innerText = icons[Math.floor(Math.random()*icons.length)];
                }, 50);

                // Logic Resolution
                setTimeout(() => {
                    clearInterval(lampInt);
                    clearInterval(spinInt);
                    reel.classList.remove('slot-blur');
                    lamps.forEach(l => l.style.backgroundColor = '#330000'); // Reset lamps

                    const scenario = this.calculateScenario(strategy);
                    this.handleScenarioResult(scenario, reel, lamps);
                }, 1000);
            }

            calculateScenario(strategy) {
                // Filter scenarios relevant to current Legal Form
                let pool = SCENARIOS.filter(s => {
                    if (!s.tags) return true; // General scenario
                    return s.tags.includes(this.currentForm.key);
                });

                // Adjust for Strategy
                if (strategy === 'safe') {
                    // Remove High Risk
                    pool = pool.filter(s => s.risk <= 1);
                    // Add Efficiency (always available in safe mode)
                    pool.push({ type: 'PROFIT', val: 1500, icon: 'üõ°Ô∏è', title: 'Sicherheitsr√ºcklage', text: 'Keine Risiken, kleiner Gewinn.', risk: 0 });
                } else if (strategy === 'risk') {
                    // Add High Risk / High Reward Weight
                    // Double the chance of Risk 3 items
                    let highRisks = pool.filter(s => s.risk === 3);
                    pool = pool.concat(highRisks); 
                }

                // Pick One
                let choice = pool[Math.floor(Math.random() * pool.length)];
                
                // Variance calculation
                let value = choice.val;
                let variance = 0.8 + (Math.random() * 0.4); // +/- 20%
                
                // Strategy Multipliers
                if (strategy === 'risk' && choice.type === 'PROFIT') value *= 1.5;
                if (strategy === 'risk' && choice.type === 'LOSS') value *= 1.2; // Risk makes losses harder too
                
                return { ...choice, actualValue: Math.floor(value) };
            }

            handleScenarioResult(scenario, reel, lamps) {
                // Visuals
                reel.innerText = scenario.icon;
                const display = document.getElementById('result-display');
                
                const isWin = scenario.actualValue >= 0;
                const colorClass = isWin ? 'text-green-400' : 'text-red-400';
                const sign = isWin ? '+' : '';

                // Lamp feedback
                if(isWin) lamps[2].style.backgroundColor = '#00ff00'; // Green
                else lamps[0].style.backgroundColor = '#ff0000'; // Red

                display.innerHTML = `
                    <div class="pop-anim flex flex-col items-center">
                        <span class="text-[9px] text-gray-400 uppercase mb-1">${scenario.title}</span>
                        <span class="text-[8px] text-gray-500 mb-1 italic leading-tight max-w-xs">"${scenario.text}"</span>
                        <span class="text-xl font-mono font-bold ${colorClass}">${sign}${scenario.actualValue} ‚Ç¨</span>
                    </div>
                `;

                // Apply Money
                this.corpMoney += scenario.actualValue;
                
                // Check Insolvency Logic IMMEDIATELY
                if (this.corpMoney < 0) {
                    this.handleDebt(Math.abs(this.corpMoney), scenario.title);
                } else {
                    // Enable Salary Button
                    this.updateHUD();
                    document.getElementById('controls-area').classList.add('hidden');
                    document.getElementById('btn-salary').classList.remove('hidden');
                }
            }

            handleDebt(amount, cause) {
                const container = document.getElementById('game-container');
                container.classList.add('shake-anim');
                
                let message = "";
                let gameOver = false;

                if (this.currentForm.liability === 'FULL') {
                    // DURCHGRIFFSHAFTUNG
                    this.privateMoney -= amount;
                    this.corpMoney = 0;
                    message = `<span class="text-red-500">ACHTUNG:</span> Das Firmenkonto ist leer. Als ${this.currentForm.name} haftest du privat! <br>Das Geld wurde von deinem Privatkonto gebucht.`;
                    
                    if (this.privateMoney < 0) {
                        this.triggerGameOver("PRIVATINSOLVENZ", `Die Schulden aus "${cause}" haben dein gesamtes privates Verm√∂gen vernichtet. Du besitzt nichts mehr.`);
                        return;
                    }
                } else {
                    // HAFTUNGSBESCHR√ÑNKUNG (GmbH/AG)
                    // Insolvenzpflicht! Spiel vorbei, aber Privatverm√∂gen sicher.
                    this.corpMoney = 0;
                    this.triggerGameOver("FIRMENINSOLVENZ", `Die Firma ist zahlungsunf√§hig durch "${cause}". Als Gesch√§ftsf√ºhrer musst du Insolvenz anmelden. Die Firma ist weg, aber dein Privatverm√∂gen ist sicher!`);
                    return;
                }

                // Update UI if survived (only Full Liability survivors get here)
                document.getElementById('result-display').innerHTML = `<div class="text-[9px] text-red-400 font-bold border border-red-500 p-1">${message}</div>`;
                this.updateHUD();
                
                // Allow continue (Wounds licked)
                document.getElementById('controls-area').classList.add('hidden');
                document.getElementById('btn-salary').classList.remove('hidden');
                document.getElementById('btn-salary').innerHTML = `<span class="text-xs">√úberleben & Weiter</span>`;
            }

            withdraw() {
                // Salary processing
                if (this.corpMoney >= this.salary) {
                    this.corpMoney -= this.salary;
                    
                    // Simple Tax Simulation
                    // OHG/EU: Income Tax (Privat)
                    // GmbH/AG: Wage Tax
                    // Simplified: You get Net money
                    let net = Math.floor(this.salary * 0.7);
                    this.privateMoney += net;
                    
                    document.getElementById('result-display').innerHTML = `<span class="text-green-400 text-xs">Gehalt gebucht (+${net}‚Ç¨)</span>`;
                } else {
                    document.getElementById('result-display').innerHTML = `<span class="text-gray-500 text-xs">Kein Geld f√ºr Gehalt.</span>`;
                }

                // Reset UI for next turn
                this.month++;
                this.spinning = false;
                this.updateHUD();
                
                setTimeout(() => {
                    document.getElementById('controls-area').classList.remove('hidden', 'opacity-50', 'pointer-events-none');
                    document.getElementById('btn-salary').classList.add('hidden');
                    document.getElementById('btn-salary').innerHTML = `<span class="text-sm font-bold">üíµ GEHALT BUCHEN</span>`; // Reset Text
                    document.getElementById('result-display').innerHTML = `<span class="text-[10px] text-gray-500">Monat ${this.month} beginnt...</span>`;
                }, 1000);

                // Victory Condition?
                if (this.month >= 24) {
                    this.triggerGameOver("GEWONNEN!", "Du hast 2 Jahre am Markt √ºberlebt. Dein Unternehmen hat sich etabliert.");
                }
            }

            triggerGameOver(title, reason) {
                this.renderTemplate('tpl-gameover');
                document.getElementById('go-title').innerText = title;
                document.getElementById('go-reason').innerHTML = reason;
                document.getElementById('go-form').innerText = this.currentForm.name;
                document.getElementById('go-months').innerText = this.month + " Monate";
                document.getElementById('go-private').innerText = this.privateMoney + " ‚Ç¨";

                const lessonEl = document.getElementById('go-lesson');
                if (this.currentForm.liability === 'FULL' && title.includes("PRIVAT")) {
                    lessonEl.innerText = "Lektion: Bei Personengesellschaften (EU, OHG, KG-Komplement√§r) gibt es keine Trennung zwischen Firma und Privatperson. Du haftest immer voll.";
                } else if (title.includes("FIRMEN")) {
                    lessonEl.innerText = "Lektion: Kapitalgesellschaften (GmbH, AG) sind juristische Personen. Gehen sie pleite, verliert man 'nur' das investierte Kapital, nicht das Privathaus.";
                }
            }

            updateHUD() {
                if(!this.ui.pMoney) return;
                this.ui.pMoney.innerText = this.privateMoney + " ‚Ç¨";
                this.ui.cMoney.innerText = this.corpMoney + " ‚Ç¨";
                this.ui.headerDay.innerText = "Monat " + this.month;
                
                // Visual warning if funds low
                this.ui.cMoney.className = this.corpMoney < 5000 ? "text-xs md:text-sm text-red-400 font-mono blink" : "text-xs md:text-sm text-white font-mono";
            }

            renderTemplate(id) {
                const tpl = document.getElementById(id);
                this.ui.screen.innerHTML = "";
                this.ui.screen.appendChild(tpl.content.cloneNode(true));
                
                // Re-bind UI elements after render
                this.ui.pMoney = document.getElementById('hud-private-money');
                this.ui.cMoney = document.getElementById('hud-corp-money');
                this.ui.headerDay = document.getElementById('header-day');
            }
        }

        const game = new FounderGame();
        game.init();
    </script>
</body>
</html>