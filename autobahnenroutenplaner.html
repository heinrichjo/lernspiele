<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autobahn-Quiz f√ºr Spedis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        /* Zus√§tzliche Stile f√ºr Drag & Drop */
        .city-item, .autobahn-item {
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .city-item:active, .autobahn-item:active {
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .route-slot {
            min-height: 4rem; /* Um sicherzustellen, dass die Zielfelder sichtbar sind */
        }
        .sortable-ghost {
            opacity: 0.4;
            background-color: #f1f1f1;
        }
        /* Zus√§tzlicher Stil f√ºr Modus Buttons (Konsistenz) */
        .autobahn-button-1, .autobahn-button-2, .ak-button {
            transition: all 0.15s;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

<div id="game-container" class="bg-white shadow-xl rounded-lg w-full max-w-4xl p-8 border-t-8 border-indigo-700">
    
    <header class="text-center mb-6">
        <h1 class="text-3xl font-extrabold text-gray-800">Autobahn-Quiz f√ºr Spedis</h1>
        <p class="text-gray-500">Testen Sie Ihr Wissen √ºber deutsche Fernstra√üen und Routenplanung.</p>
    </header>

    <div id="main-menu" class="space-y-4">
        <h2 class="text-2xl font-semibold mb-4">Hauptmen√º</h2>
        <button onclick="startGame(1)" class="w-full bg-indigo-700 hover:bg-indigo-800 text-white font-bold py-3 px-4 rounded transition duration-200">
            Modus 1: Stadt-Quiz (Autobahn zuordnen)
        </button>
        <button onclick="startGame(2)" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded transition duration-200">
            Modus 2: Routen-Planer (Einfach)
        </button>
        <button onclick="startGame(3)" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-4 rounded transition duration-200">
            Modus 3: Komplexe Routen (Mehrere Autobahnen)
        </button>
        <button onclick="startGame(4)" class="w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 px-4 rounded transition duration-200">
            Modus 4: Autobahnkreuze 
        </button>

        <div class="text-center pt-8">
            <img src="https://www.welserschule.de/wp-content/uploads/2025/11/BS4_Logo_Web_ohneSlogan.jpg" alt="Logo Welserschule" class="mx-auto h-16 mb-4">
        </div>

        <footer class="text-center text-xs text-gray-400 pt-2">
            <p>Erstellt von J. Heinrich ‚Äì Mit gro√üer Hilfe von Gemini</p>
            <p>Berufsschule IV ‚Äì Welserschule Augsburg</p>
            <p>2025</p>
        </footer>
    </div>

    <div id="stats" class="text-right text-sm text-gray-600 mb-4 hidden">
        Punkte: <span id="score" class="font-bold text-lg text-indigo-700">0</span> | Frage: <span id="question-count">0</span> / <span id="max-questions">0</span>
    </div>

    <div id="mode-1" class="hidden">
        <h2 class="text-2xl font-semibold mb-4">Modus 1: Stadt-Quiz</h2>
        <div class="p-6 bg-gray-50 border rounded-lg mb-6">
            <p class="text-lg font-medium text-gray-700">Welche Autobahn f√ºhrt an:</p>
            <p id="city-quiz-city" class="text-4xl font-extrabold text-indigo-700 mt-2">STADTNAME</p>
        </div>
        <div id="autobahn-buttons-1" class="grid grid-cols-3 gap-3">
            </div>
        <p id="feedback-1" class="text-center text-xl font-bold mt-4 h-8"></p>
        <div class="flex justify-between mt-6">
            <button onclick="nextQuestion(1)" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded disabled:opacity-50" disabled id="next-btn-1">N√§chste Frage</button>
            <button onclick="showMainMenu()" class="text-indigo-700 hover:text-indigo-800 font-medium">Zur√ºck zum Men√º</button>
        </div>
    </div>

    <div id="mode-2" class="hidden">
        <h2 class="text-2xl font-semibold mb-4">Modus 2: Routen-Planer (Einfach)</h2>
        <div class="p-4 bg-gray-50 border rounded-lg mb-4">
            <p class="text-xl font-medium text-gray-700">Route:</p>
            <p class="text-3xl font-extrabold text-emerald-700 mt-1">
                <span id="route-start-2">Startstadt</span> <span class="text-gray-400">‚Üí</span> <span id="route-end-2">Zielstadt</span>
            </p>
        </div>

        <h3 class="text-xl font-semibold mt-6 mb-3">1. Haupt-Autobahn w√§hlen (A1-A9):</h3>
        <div id="autobahn-buttons-2" class="grid grid-cols-3 gap-3">
            </div>
        <p id="feedback-a1-2" class="text-center text-lg font-bold mt-2 h-6"></p>

        <h3 class="text-xl font-semibold mt-6 mb-3">2. Zwischenstopps in korrekter Reihenfolge:</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-indigo-50 p-3 rounded-lg border-2 border-dashed border-indigo-200">
                <p class="font-bold text-indigo-800 mb-2">City-Pool (Zwischenstopps & Ablenkungen)</p>
                <div id="city-pool-2" class="space-y-2 route-slot p-2 bg-white rounded shadow-inner">
                    <p class="text-gray-400 italic">Wird beim Start gef√ºllt...</p>
                </div>
            </div>
            <div class="bg-emerald-50 p-3 rounded-lg border-2 border-dashed border-emerald-200">
                <p class="font-bold text-emerald-800 mb-2">Ihre Route (Korrekte Reihenfolge)</p>
                <div id="city-sequence-2" class="space-y-2 route-slot p-2 bg-white rounded shadow-inner">
                    <p class="text-gray-400 italic">Hier St√§dte in die richtige Reihenfolge ziehen.</p>
                </div>
            </div>
        </div>

        <p id="feedback-a2-2" class="text-center text-lg font-bold mt-4 h-6"></p>
        
        <div class="flex justify-between mt-6">
            <button onclick="checkAnswer(2)" class="bg-indigo-700 hover:bg-indigo-800 text-white font-bold py-2 px-4 rounded transition duration-200" id="check-btn-2">Antwort pr√ºfen & Weiter</button>
            <button onclick="showMainMenu()" class="text-indigo-700 hover:text-indigo-800 font-medium">Zur√ºck zum Men√º</button>
        </div>
        <p id="feedback-overall-2" class="text-center text-xl font-bold mt-4 h-8"></p>

    </div>

    <div id="mode-3" class="hidden">
        <h2 class="text-2xl font-semibold mb-4">Modus 3: Komplexe Routen</h2>
        <div class="p-4 bg-gray-50 border rounded-lg mb-4">
            <p class="text-xl font-medium text-gray-700">Route:</p>
            <p class="text-3xl font-extrabold text-amber-700 mt-1">
                <span id="route-start-3">Startstadt</span> <span class="text-gray-400">‚Üí</span> <span id="route-end-3">Zielstadt</span>
            </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <div>
                <h3 class="text-xl font-semibold mt-6 mb-3">1. Autobahn-Reihenfolge (2-3 Autobahnen):</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-indigo-50 p-3 rounded-lg border-2 border-dashed border-indigo-200">
                        <p class="font-bold text-indigo-800 mb-2">Autobahn-Pool (A1-A9)</p>
                        <div id="autobahn-pool-3" class="flex flex-wrap gap-2 route-slot p-2 bg-white rounded shadow-inner">
                            <p class="text-gray-400 italic">Wird beim Start gef√ºllt...</p>
                        </div>
                    </div>
                    <div class="bg-amber-50 p-3 rounded-lg border-2 border-dashed border-amber-200">
                        <p class="font-bold text-amber-800 mb-2">Ihre Sequenz</p>
                        <div id="autobahn-sequence-3" class="flex flex-wrap gap-2 route-slot p-2 bg-white rounded shadow-inner">
                            <p class="text-gray-400 italic">Hier die korrekten Autobahnen in Sequenz ziehen.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-semibold mt-6 mb-3">2. Zwischenstopps in korrekter Reihenfolge:</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-indigo-50 p-3 rounded-lg border-2 border-dashed border-indigo-200">
                        <p class="font-bold text-indigo-800 mb-2">City-Pool (Zwischenstopps & Ablenkungen)</p>
                        <div id="city-pool-3" class="space-y-2 route-slot p-2 bg-white rounded shadow-inner">
                            <p class="text-gray-400 italic">Wird beim Start gef√ºllt...</p>
                        </div>
                    </div>
                    <div class="bg-amber-50 p-3 rounded-lg border-2 border-dashed border-amber-200">
                        <p class="font-bold text-amber-800 mb-2">Ihre Route (Korrekte Reihenfolge)</p>
                        <div id="city-sequence-3" class="space-y-2 route-slot p-2 bg-white rounded shadow-inner">
                            <p class="text-gray-400 italic">Hier St√§dte in die richtige Reihenfolge ziehen.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="flex justify-between mt-8">
            <button onclick="checkAnswer(3)" class="bg-indigo-700 hover:bg-indigo-800 text-white font-bold py-2 px-4 rounded transition duration-200" id="check-btn-3">Antwort pr√ºfen & Weiter</button>
            <button onclick="showMainMenu()" class="text-indigo-700 hover:text-indigo-800 font-medium">Zur√ºck zum Men√º</button>
        </div>
        <p id="feedback-overall-3" class="text-center text-xl font-bold mt-4 h-8"></p>
    </div>

    <div id="mode-4" class="hidden">
        <h2 class="text-2xl font-semibold mb-4">Modus 4: Autobahnkreuze</h2>
        <div class="p-6 bg-gray-50 border rounded-lg mb-6 text-center">
            <p class="text-lg font-medium text-gray-700">Wie hei√üt das Autobahnkreuz von:</p>
            <p id="ak-autobahnen" class="text-4xl font-extrabold text-slate-700 mt-2">A? / A??</p>
        </div>
        <div id="ak-options" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            </div>
        <p id="feedback-4" class="text-center text-xl font-bold mt-4 h-8"></p>
        <div class="flex justify-between mt-6">
            <button onclick="nextQuestion(4)" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded disabled:opacity-50" disabled id="next-btn-4">N√§chste Frage</button>
            <button onclick="showMainMenu()" class="text-indigo-700 hover:text-indigo-800 font-medium">Zur√ºck zum Men√º</button>
        </div>
    </div>

</div>

<script>
    // -------------------------------------------------------------------------
    // I. SPIELDATEN
    // -------------------------------------------------------------------------

    const ALL_AUTOBAHNEN = ['A1', 'A2', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'A9'];

    // Modus 1: Stadt-Quiz Daten (MEHRERE KORREKTE ANTWORTEN M√ñGLICH)
    const QUIZ_M1_DATA = [
        { city: "Dortmund", correct: ["A2", "A1"] },
        { city: "Mannheim", correct: ["A6", "A61", "A5"] },
        { city: "Bremen", correct: ["A1", "A27"] },
        { city: "W√ºrzburg", correct: ["A3", "A7"] },
        { city: "Freiburg", correct: ["A5"] },
        { city: "M√ºnchen", correct: ["A8", "A9"] },
        { city: "G√∂rlitz", correct: ["A4"] },
        { city: "Ulm", correct: ["A8"] }
    ];

    // Modus 2: Routen-Planer (Einfach) Daten
    const QUIZ_M2_DATA = [
        { 
            start: "Hamburg", 
            end: "Saarbr√ºcken", 
            autobahn: "A1", 
            cities: ["Osnabr√ºck", "Dortmund", "K√∂ln", "Trier"], 
            distractions: ["Berlin", "Dresden", "Kassel", "N√ºrnberg"] 
        },
        { 
            start: "Oberhausen", 
            end: "Passau", 
            autobahn: "A3", 
            cities: ["K√∂ln", "Frankfurt", "W√ºrzburg", "N√ºrnberg"], 
            distractions: ["Stuttgart", "M√ºnchen", "Hannover", "Magdeburg"] 
        },
        { 
            start: "Frankfurt", 
            end: "Basel", 
            autobahn: "A5", 
            cities: ["Darmstadt", "Karlsruhe", "Freiburg"], 
            distractions: ["Leipzig", "Bremen", "Berlin", "Erfurt"] 
        },
    ];

    // Modus 3: Komplexe Routen Daten
    const QUIZ_M3_DATA = [
        {
            start: "Rostock",
            end: "Stuttgart",
            autobahnen: ["A19", "A9", "A6"],
            cities: ["Berlin", "N√ºrnberg", "Heilbronn"],
            distractions: ["K√∂ln", "Dortmund", "M√ºnchen", "Hamburg"]
        },
        {
            start: "Aachen",
            end: "Dresden",
            autobahnen: ["A4", "A44", "A3"],
            cities: ["K√∂ln", "Olpe", "Bad Hersfeld", "Jena", "Chemnitz"],
            distractions: ["Bremen", "M√ºnchen", "Kiel"]
        }
    ];

    // Modus 4: Autobahnkreuze
    const QUIZ_M4_DATA = [
        { autobahnen: ["A8", "A9"], correct: "AK M√ºnchen-S√ºd" },
        { autobahnen: ["A3", "A7"], correct: "AK Biebelried" },
        { autobahnen: ["A1", "A4"], correct: "AK K√∂ln-West" },
        { autobahnen: ["A2", "A7"], correct: "AK Hannover-Ost" },
        { autobahnen: ["A4", "A9"], correct: "AD Hermsdorfer Kreuz" }, // AD f√ºr Autobahndreieck
        { autobahnen: ["A5", "A6"], correct: "AK Walldorf" },
        { autobahnen: ["A1", "A8"], correct: "AK Saarbr√ºcken" },
        { autobahnen: ["A3", "A4"], correct: "AK Heumar" }
    ];
    
    // Globale Spielvariablen
    let currentMode = 0;
    let score = 0;
    let currentQuestionIndex = 0;
    let currentQuizData = [];
    let selectedAutobahn = null; // F√ºr Modus 2

    // SortableJS Instanzen
    let sortableCityPool2, sortableCitySequence2;
    let sortableAutobahnPool3, sortableAutobahnSequence3;
    let sortableCityPool3, sortableCitySequence3;

    // -------------------------------------------------------------------------
    // II. INITIALISIERUNG & ZUSTANDSVERWALTUNG
    // -------------------------------------------------------------------------

    /**
     * Mischt ein Array.
     * @param {Array} array Das zu mischende Array.
     * @returns {Array} Das gemischte Array.
     */
    function shuffleArray(array) {
        let newArray = [...array];
        for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
        }
        return newArray;
    }

    /**
     * Zeigt nur den Container f√ºr den gegebenen Modus und die Statistik an/aus.
     * @param {number} mode Der zu aktivierende Modus (0 f√ºr Men√º).
     */
    function showScreen(mode) {
        document.getElementById('main-menu').classList.toggle('hidden', mode !== 0);
        document.getElementById('mode-1').classList.toggle('hidden', mode !== 1);
        document.getElementById('mode-2').classList.toggle('hidden', mode !== 2);
        document.getElementById('mode-3').classList.toggle('hidden', mode !== 3);
        document.getElementById('mode-4').classList.toggle('hidden', mode !== 4);
        document.getElementById('stats').classList.toggle('hidden', mode === 0);
    }

    /**
     * Kehrt zum Hauptmen√º zur√ºck und setzt den Spielstatus zur√ºck.
     */
    function showMainMenu() {
        resetGameStatus();
        showScreen(0);
    }

    /**
     * Setzt die globalen Spielvariablen zur√ºck.
     */
    function resetGameStatus() {
        currentMode = 0;
        score = 0;
        currentQuestionIndex = 0;
        currentQuizData = [];
        selectedAutobahn = null;
        document.getElementById('score').textContent = score;
        document.getElementById('question-count').textContent = 0;
        document.getElementById('max-questions').textContent = 0;
    }

    /**
     * Startet den ausgew√§hlten Spielmodus.
     * @param {number} mode Der zu startende Modus (1, 2, 3 oder 4).
     */
    function startGame(mode) {
        resetGameStatus();
        currentMode = mode;
        
        if (mode === 1) {
            currentQuizData = shuffleArray(QUIZ_M1_DATA);
            generateAutobahnButtons(1, checkAnswerM1);
            loadQuestion(1);
        } else if (mode === 2) {
            currentQuizData = shuffleArray(QUIZ_M2_DATA);
            generateAutobahnButtons(2, selectAutobahnM2);
            initializeDragAndDrop(2);
            loadQuestion(2);
        } else if (mode === 3) {
            currentQuizData = shuffleArray(QUIZ_M3_DATA);
            initializeDragAndDrop(3);
            loadQuestion(3);
        } else if (mode === 4) {
            currentQuizData = shuffleArray(QUIZ_M4_DATA);
            loadQuestion(4);
        }

        document.getElementById('max-questions').textContent = currentQuizData.length;
        showScreen(mode);
    }

    /**
     * L√§dt die n√§chste Frage f√ºr den aktuellen Modus.
     * @param {number} mode Der Modus (1, 2, 3 oder 4).
     */
    function loadQuestion(mode) {
        if (currentQuestionIndex >= currentQuizData.length) {
            alert(`Spiel beendet! Sie haben ${score} von ${currentQuizData.length} Punkten erreicht.`);
            showMainMenu();
            return;
        }

        const question = currentQuizData[currentQuestionIndex];
        document.getElementById('question-count').textContent = currentQuestionIndex + 1;

        if (mode === 1) {
            document.getElementById('city-quiz-city').textContent = question.city;
            document.getElementById('feedback-1').textContent = '';
            document.getElementById('next-btn-1').disabled = true;
            // Alle Buttons wieder aktivieren und Grundfarbe zuweisen
            document.querySelectorAll('#autobahn-buttons-1 button').forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('bg-emerald-600', 'hover:bg-emerald-700', 'bg-red-700', 'hover:bg-red-800');
                btn.classList.add('bg-indigo-700', 'hover:bg-indigo-800');
            });
        } else if (mode === 2) {
            document.getElementById('route-start-2').textContent = question.start;
            document.getElementById('route-end-2').textContent = question.end;
            document.getElementById('feedback-a1-2').textContent = '';
            document.getElementById('feedback-overall-2').textContent = '';
            selectedAutobahn = null;

            // Zur√ºcksetzen Autobahn-Buttons
            document.querySelectorAll('#autobahn-buttons-2 button').forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('ring-4', 'ring-indigo-300', 'bg-emerald-600', 'bg-red-700');
                btn.classList.add('bg-indigo-700'); // Grundfarbe f√ºr Buttons
            });
            document.getElementById('check-btn-2').disabled = false;

            // Zur√ºcksetzen Drag & Drop
            const allCities = shuffleArray([...question.cities, ...question.distractions]);
            
            // F√ºlle City-Pool
            document.getElementById('city-pool-2').innerHTML = allCities.map(city => 
                `<div class="city-item bg-white p-2 border rounded shadow-sm hover:shadow-md" data-city="${city}">${city}</div>`
            ).join('');
            
            // Leere Ziel-Sequenz
            document.getElementById('city-sequence-2').innerHTML = '<p class="text-gray-400 italic">Hier St√§dte in die richtige Reihenfolge ziehen.</p>';
            sortableCitySequence2.option("emptyInsertThreshold", 1); 
            sortableCityPool2.option("emptyInsertThreshold", 1);
        } else if (mode === 3) {
            document.getElementById('route-start-3').textContent = question.start;
            document.getElementById('route-end-3').textContent = question.end;
            document.getElementById('feedback-overall-3').textContent = '';
            document.getElementById('check-btn-3').disabled = false;

            // Zur√ºcksetzen Autobahn-D&D (Grundfarbe)
            const autobahnPool = shuffleArray(ALL_AUTOBAHNEN.filter(a => !question.autobahnen.includes(a) || Math.random() < 0.5).concat(question.autobahnen)); 
            
            document.getElementById('autobahn-pool-3').innerHTML = autobahnPool.map(a => 
                `<div class="autobahn-item bg-indigo-200 text-indigo-800 font-bold p-2 border rounded shadow-sm hover:shadow-md" data-autobahn="${a}">${a}</div>`
            ).join('');
            document.getElementById('autobahn-sequence-3').innerHTML = '<p class="text-gray-400 italic">Hier die korrekten Autobahnen in Sequenz ziehen.</p>';
            sortableAutobahnSequence3.option("emptyInsertThreshold", 1);
            sortableAutobahnPool3.option("emptyInsertThreshold", 1);

            // Zur√ºcksetzen St√§dte-D&D
            const allCities = shuffleArray([...question.cities, ...question.distractions]);
            
            document.getElementById('city-pool-3').innerHTML = allCities.map(city => 
                `<div class="city-item bg-white p-2 border rounded shadow-sm hover:shadow-md" data-city="${city}">${city}</div>`
            ).join('');
            document.getElementById('city-sequence-3').innerHTML = '<p class="text-gray-400 italic">Hier St√§dte in die richtige Reihenfolge ziehen.</p>';
            sortableCitySequence3.option("emptyInsertThreshold", 1);
            sortableCityPool3.option("emptyInsertThreshold", 1);
        } else if (mode === 4) {
            document.getElementById('ak-autobahnen').textContent = `${question.autobahnen[0]} / ${question.autobahnen[1]}`;
            document.getElementById('feedback-4').textContent = '';
            document.getElementById('next-btn-4').disabled = true;

            const distractions = QUIZ_M4_DATA
                                .map(q => q.correct)
                                .filter(name => name !== question.correct)
                                .sort(() => 0.5 - Math.random())
                                .slice(0, 3); // 3 Ablenkungen
            const options = shuffleArray([question.correct, ...distractions]);

            document.getElementById('ak-options').innerHTML = options.map(ak => 
                `<button onclick="checkAnswerM4(this, '${ak.replace(/'/g, "\\'")}')" 
                         class="ak-button bg-slate-600 hover:bg-slate-700 text-white font-bold py-4 px-4 rounded transition duration-150">
                    ${ak}
                </button>`
            ).join('');
        }
    }

    /**
     * Wechselt zur n√§chsten Frage und aktualisiert den Punktestand.
     * @param {number} mode Der Modus (1, 2, 3 oder 4).
     */
    function nextQuestion(mode, isCorrect = false) {
        if (isCorrect) {
            score++;
            document.getElementById('score').textContent = score;
        }
        currentQuestionIndex++;
        
        setTimeout(() => {
            loadQuestion(mode);
        }, 1500);
    }

    // -------------------------------------------------------------------------
    // III. MODUS 1: STADT-QUIZ
    // -------------------------------------------------------------------------

    /**
     * Generiert A1-A9 Buttons f√ºr Modus 1 und 2.
     * @param {number} mode Der Modus (1 oder 2).
     * @param {function} handler Die Funktion, die beim Klick ausgef√ºhrt wird.
     */
    function generateAutobahnButtons(mode, handler) {
        const containerId = mode === 1 ? 'autobahn-buttons-1' : 'autobahn-buttons-2';
        const container = document.getElementById(containerId);
        const functionName = handler.name;

        // Grundfarbe f√ºr diese Buttons ist jetzt indigo-700
        container.innerHTML = ALL_AUTOBAHNEN.map(a => 
            `<button onclick="${functionName}(this, '${a}')" 
                     class="autobahn-button-${mode} bg-indigo-700 hover:bg-indigo-800 text-white font-bold py-3 rounded transition duration-150">
                ${a}
            </button>`
        ).join('');
    }

    /**
     * Pr√ºft die Antwort f√ºr Modus 1 (Stadt-Quiz).
     * @param {HTMLElement} button Der geklickte Button.
     * @param {string} selected Die ausgew√§hlte Autobahn.
     */
    function checkAnswerM1(button, selected) {
        const currentQ = currentQuizData[currentQuestionIndex];
        const correctOptions = currentQ.correct;
        const feedback = document.getElementById('feedback-1');
        
        document.querySelectorAll('#autobahn-buttons-1 button').forEach(btn => btn.disabled = true);

        if (correctOptions.includes(selected)) {
            feedback.textContent = 'Richtig! ‚úÖ';
            feedback.classList.remove('text-red-700');
            feedback.classList.add('text-emerald-600'); // ERFOLGSFARBE
            button.classList.remove('bg-indigo-700', 'hover:bg-indigo-800');
            button.classList.add('bg-emerald-600', 'hover:bg-emerald-700'); // ERFOLGSFARBE F√úR BUTTON
            nextQuestion(1, true);
        } else {
            const correctStr = correctOptions.length > 1 ? correctOptions.join(' oder ') : correctOptions[0];
            feedback.textContent = `Falsch. ‚ùå Korrekt w√§re ${correctStr}.`;
            feedback.classList.remove('text-emerald-600');
            feedback.classList.add('text-red-700'); // FEHLERFARBE
            button.classList.remove('bg-indigo-700', 'hover:bg-indigo-800');
            button.classList.add('bg-red-700', 'hover:bg-red-800'); // FEHLERFARBE F√úR BUTTON
            
            document.querySelectorAll('#autobahn-buttons-1 button').forEach(btn => {
                // Korrekten Button hervorheben (falls nicht der angeklickte war)
                if (correctOptions.includes(btn.textContent.trim())) {
                    btn.classList.remove('bg-indigo-700', 'hover:bg-indigo-800', 'bg-red-700', 'hover:bg-red-800');
                    btn.classList.add('bg-emerald-600'); // Korrekter Button wird gr√ºn
                }
            });
            document.getElementById('next-btn-1').disabled = false;
        }
    }
    
    // -------------------------------------------------------------------------
    // IV. MODUS 2 & 3: DRAG & DROP INITIALISIERUNG
    // -------------------------------------------------------------------------

    /**
     * Initialisiert die SortableJS Instanzen f√ºr Drag & Drop.
     * @param {number} mode Der Modus (2 oder 3).
     */
    function initializeDragAndDrop(mode) {
        if (mode === 2) {
            const cityPool = document.getElementById('city-pool-2');
            const citySequence = document.getElementById('city-sequence-2');

            if (sortableCityPool2) { 
                sortableCityPool2.destroy(); 
                sortableCitySequence2.destroy();
            }

            sortableCityPool2 = new Sortable(cityPool, {
                group: { name: 'cities2', pull: 'clone', put: true },
                animation: 150,
                sort: false,
                filter: '.text-gray-400' 
            });

            sortableCitySequence2 = new Sortable(citySequence, {
                group: { name: 'cities2', pull: true, put: true },
                animation: 150,
                sort: true,
                onStart: function (evt) {
                    citySequence.querySelector('.text-gray-400')?.remove();
                },
                onRemove: function (evt) {
                    if (sortableCitySequence2.toArray().length === 0) {
                        citySequence.innerHTML = '<p class="text-gray-400 italic">Hier St√§dte in die richtige Reihenfolge ziehen.</p>';
                    }
                }
            });
        } else if (mode === 3) {
            if (sortableAutobahnPool3) { 
                sortableAutobahnPool3.destroy(); 
                sortableAutobahnSequence3.destroy();
                sortableCityPool3.destroy();
                sortableCitySequence3.destroy();
            }
            
            // Autobahn D&D
            const autobahnPool = document.getElementById('autobahn-pool-3');
            const autobahnSequence = document.getElementById('autobahn-sequence-3');
            sortableAutobahnPool3 = new Sortable(autobahnPool, {
                group: { name: 'autobahnen3', pull: 'clone', put: true },
                animation: 150,
                sort: false,
                filter: '.text-gray-400'
            });
            sortableAutobahnSequence3 = new Sortable(autobahnSequence, {
                group: { name: 'autobahnen3', pull: true, put: true },
                animation: 150,
                sort: true,
                onStart: function (evt) {
                    autobahnSequence.querySelector('.text-gray-400')?.remove();
                },
                onRemove: function (evt) {
                    if (sortableAutobahnSequence3.toArray().length === 0) {
                        autobahnSequence.innerHTML = '<p class="text-gray-400 italic">Hier die korrekten Autobahnen in Sequenz ziehen.</p>';
                    }
                }
            });

            // St√§dte D&D
            const cityPool = document.getElementById('city-pool-3');
            const citySequence = document.getElementById('city-sequence-3');
            sortableCityPool3 = new Sortable(cityPool, {
                group: { name: 'cities3', pull: 'clone', put: true },
                animation: 150,
                sort: false,
                filter: '.text-gray-400'
            });
            sortableCitySequence3 = new Sortable(citySequence, {
                group: { name: 'cities3', pull: true, put: true },
                animation: 150,
                sort: true,
                onStart: function (evt) {
                    citySequence.querySelector('.text-gray-400')?.remove();
                },
                onRemove: function (evt) {
                    if (sortableCitySequence3.toArray().length === 0) {
                        citySequence.innerHTML = '<p class="text-gray-400 italic">Hier St√§dte in die richtige Reihenfolge ziehen.</p>';
                    }
                }
            });
        }
    }

    // -------------------------------------------------------------------------
    // V. MODUS 2 & 3: ROUTEN-PLANER
    // -------------------------------------------------------------------------

    /**
     * Speichert die ausgew√§hlte Autobahn f√ºr Modus 2.
     * @param {HTMLElement} button Der geklickte Button.
     * @param {string} selected Die ausgew√§hlte Autobahn.
     */
    function selectAutobahnM2(button, selected) {
        selectedAutobahn = selected;
        
        // Markierung zur√ºcksetzen und neue Markierung setzen
        document.querySelectorAll('#autobahn-buttons-2 button').forEach(btn => {
            btn.classList.remove('ring-4', 'ring-indigo-300');
        });
        button.classList.add('ring-4', 'ring-indigo-300'); // Highlight-Farbe
        document.getElementById('feedback-a1-2').textContent = `Autobahn ${selected} ausgew√§hlt.`;
        document.getElementById('feedback-a1-2').classList.remove('text-red-700', 'text-emerald-600');
        document.getElementById('feedback-a1-2').classList.add('text-gray-600');
    }

    /**
     * Pr√ºft die vollst√§ndige Antwort f√ºr Modus 2 und 3.
     * @param {number} mode Der Modus (2 oder 3).
     */
    function checkAnswer(mode) {
        const currentQ = currentQuizData[currentQuestionIndex];
        let correctAutobahn = false;
        let correctSequence = false;
        let overallFeedback = document.getElementById(`feedback-overall-${mode}`);

        if (mode === 2) {
            // Aufgabe 1: Autobahn-Pr√ºfung
            const autobahnFeedback = document.getElementById('feedback-a1-2');
            if (selectedAutobahn === currentQ.autobahn) {
                correctAutobahn = true;
                autobahnFeedback.textContent = `1. Autobahn: Korrekt! (${currentQ.autobahn}) ‚úÖ`;
                autobahnFeedback.classList.remove('text-gray-600', 'text-red-700');
                autobahnFeedback.classList.add('text-emerald-600'); // ERFOLGSFARBE
            } else {
                correctAutobahn = false;
                autobahnFeedback.textContent = `1. Autobahn: Falsch. Korrekt ist ${currentQ.autobahn}. ‚ùå`;
                autobahnFeedback.classList.remove('text-gray-600', 'text-emerald-600');
                autobahnFeedback.classList.add('text-red-700'); // FEHLERFARBE
            }
            // Buttons deaktivieren und korrekten markieren
            document.querySelectorAll('#autobahn-buttons-2 button').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent.trim() === currentQ.autobahn) {
                    btn.classList.remove('bg-indigo-700', 'ring-4', 'ring-indigo-300'); 
                    btn.classList.add('bg-emerald-600'); // Korrekter Button erh√§lt Erfolgsfarbe
                } else {
                    btn.classList.remove('bg-indigo-700', 'ring-4', 'ring-indigo-300');
                    btn.classList.add('bg-red-700'); // Falsche Buttons erhalten Fehlerfarbe
                }
            });

            // Aufgabe 2: St√§dte-Sequenz-Pr√ºfung
            const sequenceFeedback = document.getElementById('feedback-a2-2');
            const sequence = sortableCitySequence2.toArray().map(id => document.querySelector(`[data-city="${id}"]`)?.dataset.city || id);
            
            if (sequence.join(',') === currentQ.cities.join(',')) {
                correctSequence = true;
                sequenceFeedback.textContent = '2. Sequenz: Korrekt! ‚úÖ';
                sequenceFeedback.classList.remove('text-red-700');
                sequenceFeedback.classList.add('text-emerald-600'); // ERFOLGSFARBE
            } else {
                correctSequence = false;
                sequenceFeedback.textContent = '2. Sequenz: Falsch. Die richtige Reihenfolge ist ' + currentQ.cities.join(' ‚Üí ') + '. ‚ùå';
                sequenceFeedback.classList.remove('text-emerald-600');
                sequenceFeedback.classList.add('text-red-700'); // FEHLERFARBE
            }

            // Gesamtergebnis
            if (correctAutobahn && correctSequence) {
                overallFeedback.textContent = 'Beide Aufgaben korrekt! +1 Punkt. üéâ';
                overallFeedback.classList.remove('text-red-700');
                overallFeedback.classList.add('text-emerald-600'); // ERFOLGSFARBE
                document.getElementById('check-btn-2').disabled = true;
                nextQuestion(2, true);
            } else {
                overallFeedback.textContent = 'Leider nicht beide Aufgaben korrekt. üòî';
                overallFeedback.classList.remove('text-emerald-600');
                overallFeedback.classList.add('text-red-700'); // FEHLERFARBE
                document.getElementById('check-btn-2').disabled = true;
                nextQuestion(2, false);
            }

        } else if (mode === 3) {
            // Modus 3 Pr√ºfungen

            // Aufgabe 1: Autobahn-Sequenz-Pr√ºfung
            const autobahnSeq = sortableAutobahnSequence3.toArray().map(id => document.querySelector(`#autobahn-sequence-3 [data-autobahn="${id}"]`)?.dataset.autobahn || id);
            if (autobahnSeq.join(',') === currentQ.autobahnen.join(',')) {
                correctAutobahn = true;
            }

            // Aufgabe 2: St√§dte-Sequenz-Pr√ºfung
            const citySeq = sortableCitySequence3.toArray().map(id => document.querySelector(`#city-sequence-3 [data-city="${id}"]`)?.dataset.city || id);
            if (citySeq.join(',') === currentQ.cities.join(',')) {
                correctSequence = true;
            }

            // Visuelles Feedback
            const autFeedbackEl = document.getElementById('autobahn-sequence-3').parentElement.previousElementSibling;
            autFeedbackEl.textContent = 'Ihre Sequenz' + (correctAutobahn ? ' (Korrekt ‚úÖ)' : ' (Falsch ‚ùå)');
            autFeedbackEl.classList.toggle('text-emerald-800', correctAutobahn); // ERFOLGSFARBE
            autFeedbackEl.classList.toggle('text-red-700', !correctAutobahn); // FEHLERFARBE
            
            const cityFeedbackEl = document.getElementById('city-sequence-3').parentElement.previousElementSibling;
            cityFeedbackEl.textContent = 'Ihre Route (Korrekte Reihenfolge)' + (correctSequence ? ' (Korrekt ‚úÖ)' : ' (Falsch ‚ùå)');
            cityFeedbackEl.classList.toggle('text-emerald-800', correctSequence); // ERFOLGSFARBE
            cityFeedbackEl.classList.toggle('text-red-700', !correctSequence); // FEHLERFARBE

            // Gesamtergebnis
            if (correctAutobahn && correctSequence) {
                overallFeedback.textContent = 'Beide Sequenzen korrekt! +1 Punkt. üéâ';
                overallFeedback.classList.remove('text-red-700');
                overallFeedback.classList.add('text-emerald-600'); // ERFOLGSFARBE
                document.getElementById('check-btn-3').disabled = true;
                nextQuestion(3, true);
            } else {
                overallFeedback.textContent = 'Leider nicht beide Sequenzen korrekt. üòî';
                overallFeedback.classList.remove('text-emerald-600');
                overallFeedback.classList.add('text-red-700'); // FEHLERFARBE
                document.getElementById('check-btn-3').disabled = true;
                
                // Details anzeigen
                const correctAutobahnenStr = currentQ.autobahnen.join(' ‚Üí ');
                const correctCitiesStr = currentQ.cities.join(' ‚Üí ');
                setTimeout(() => {
                    alert(`Details zur richtigen L√∂sung:\n\nKorrekte Autobahn-Sequenz: ${correctAutobahnenStr}\nKorrekte St√§dte-Sequenz: ${correctCitiesStr}`);
                    nextQuestion(3, false);
                }, 100);
            }
        }
    }

    // -------------------------------------------------------------------------
    // VI. MODUS 4: AUTOBAHNKREUZE
    // -------------------------------------------------------------------------

    /**
     * Pr√ºft die Antwort f√ºr Modus 4 (Autobahnkreuze).
     * @param {HTMLElement} button Der geklickte Button.
     * @param {string} selected Die ausgew√§hlte Option.
     */
    function checkAnswerM4(button, selected) {
        const currentQ = currentQuizData[currentQuestionIndex];
        const feedback = document.getElementById('feedback-4');
        
        document.querySelectorAll('#ak-options button').forEach(btn => btn.disabled = true);

        if (selected === currentQ.correct) {
            feedback.textContent = 'Richtig! AK gefunden. ‚úÖ';
            feedback.classList.remove('text-red-700');
            feedback.classList.add('text-emerald-600'); // ERFOLGSFARBE
            button.classList.remove('bg-slate-600', 'hover:bg-slate-700');
            button.classList.add('bg-emerald-600', 'hover:bg-emerald-700'); // ERFOLGSFARBE F√úR BUTTON
            nextQuestion(4, true);
        } else {
            feedback.textContent = `Falsch. ‚ùå Korrekt ist: ${currentQ.correct}.`;
            feedback.classList.remove('text-emerald-600');
            feedback.classList.add('text-red-700'); // FEHLERFARBE
            button.classList.remove('bg-slate-600', 'hover:bg-slate-700');
            button.classList.add('bg-red-700', 'hover:bg-red-800'); // FEHLERFARBE F√úR BUTTON
            
            document.querySelectorAll('#ak-options button').forEach(btn => {
                if (btn.textContent.trim() === currentQ.correct) {
                    btn.classList.remove('bg-slate-600', 'hover:bg-slate-700', 'bg-red-700', 'hover:bg-red-800');
                    btn.classList.add('bg-emerald-600'); // Korrekter Button wird gr√ºn
                }
            });
            document.getElementById('next-btn-4').disabled = false;
        }
    }


    // Beim Laden des Skripts das Hauptmen√º anzeigen
    document.addEventListener('DOMContentLoaded', () => {
        showScreen(0);
    });
</script>

</body>
</html>